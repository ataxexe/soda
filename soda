#!/bin/sh

[[ -z "$SODA_DIR" ]] && SODA_DIR=$(pwd)
[[ -z "$SODA_USER_DIR" ]] && SODA_USER_DIR=$HOME/.soda

. $SODA_DIR/soda.conf
. $SODA_DIR/scripts/core.sh

if [[ -f "$SODA_USER_DIR/soda.conf" ]]; then
  . $SODA_USER_DIR/soda.conf
fi

SODA_RESOURCES=$SODA_USER_DIR/resources

# Conventionally import common namespace
import common

function usage {
  echo """Usage: $0 [OPTIONS] FUNCTION
    OPTIONS:
    -o | --options FILE            Sets the file to parse as options
    -v | --verbose                 Prints debug messages
    -h | --help                    Prints this help message
"""
  printf "$PUBLIC_FUNCTIONS_USAGE"
  echo ""
  exit 0
}

for arg in "${@}"; do
  case $arg in
    -h | --help)
      usage
      ;;
    -v | --verbose)
      DEBUG=true
      shift
      ;;
    -o | --options)
      debug "Loading options: $2"
      . "$2"
      shift
      shift
      ;;
  esac
done

[[ "$#" = "0" ]] && usage

[[ -n "$LOG_FILE" ]]              > $LOG_FILE
[[ -n "$OPTIONS_FILE" ]]          > $OPTIONS_FILE
[[ -n "$COMMAND_LOG_FILE" ]]      > $COMMAND_LOG_FILE
[[ -n "$LAST_COMMAND_LOG_FILE" ]] > $LAST_COMMAND_LOG_FILE

call $@

finish
