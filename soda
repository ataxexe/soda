#!/bin/sh

[[ -z "$SODA_DIR" ]] && SODA_DIR=$(pwd)
[[ -z "$SODA_USER_DIR" ]] && SODA_USER_DIR=$HOME/.soda

. $SODA_DIR/soda.conf
. $SODA_DIR/scripts/core.sh

if [[ -f "$SODA_USER_DIR/soda.conf" ]]; then
  . $SODA_USER_DIR/soda.conf
fi

SODA_RESOURCES=$SODA_USER_DIR/resources

function usage {
  for namespace in $(ls $SODA_USER_DIR/scripts); do
    import "$namespace"
  done

  echo "Usage: $(basename $0) [*PARAMETERS] FUNCTION [*ARGS]"
  printf "$OPTIONS_USAGE\n\n"
  printf "$PUBLIC_FUNCTIONS_USAGE\n"
  exit 1
}

SODA_PARAMETERS=""

for arg in "${@}"; do
  case $arg in
    --*)
      SODA_PARAMETERS="$SODA_PARAMETERS $arg"
      set_parameter "$arg"
      shift
      ;;
  esac
done

# Imports common and soda namespace
import soda
import common

parameter "import=NAMESPACE" "Imports the given namespace" && {
  import "$import"
}

parameter "help" "Prints this help message" && {
  usage
}

parameter "options=NAME" "Loads the $SODA_USER_DIR/options/NAME.conf file" && {
  . $SODA_USER_DIR/options/$options.conf
}

[[ "$#" = "0" ]] && usage

call "$@"

finish
